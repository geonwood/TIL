## 03. 이미지 빌드
### 이미지와 레이어
#### 정의
- 이미지는 레이어들의 집합으로 이루어 져 있으며, 하나의 레이어는 변경사항을 나타낸다.

- 변경사항이 같다면(레이어 내용이 동일하다면), 여러 이미지가 하나의 레이어를 공유할 수 있다.

#### 특징
- **Layering** : 레이어는 이전 레이어에 대한 변경사항으로써 쌓이며, 여러 이미지간에 공유될 수 있다. 이로써 중복데이터를 최소화 하고, 빌드 속도 향상 시킨다.
- **Copy-on-Write 전략** : 변경사항이 생기면, 기존 레이어를 변경하는것이 아니라 변경사항에 대한 레이어를 추가한다. 기존 레이어는 읽기전용이다!
- **Immutable Layers** : 이미 생성된 레이어는 변경이 불가능하다.
- **Caching** : 빌드된 레이어를 캐시하여 재사용할 수 있다.

### 이미지 빌드 방식
- **Image Commit** : 실행중인 컨테이너를 이미지 생성.
- **Image Build** : Dockerfile이라는 소스코드를 통해 이미지 생성.
    - IaC(Infrastructure as Code) : 인프라를 코드로 관리하는 방법
    - 작업 효율, 휴먼에러 관리, 버전 관리, 지식 전파에 유리 등의 이유로 Image Build 선호.
    - Dockerfile을 작성하기 위해 관련 [문법 학습](https://docs.docker.com/reference/dockerfile/) 필요

#### 빌드 컨텍스트
- 이미지 빌드에 필요한 파일과 Dockerfile이 포함된 directory.
- 빌드 컨텍스트에는 빌드에 필요한 리소스만 포함되어있는것이 좋다.
    - 빌드 시 불필요한 리소스를 읽지않기 위해.

#### 멀티 스테이지 빌드
- app 빌드와 app 실행을 하나의 이미지에 담을 경우 문제 발생
    - app 실행시에는 빌드하기 위한 library들이 불필요하지만 그 내용이 포함되어 이미지가 커진다.
- app 빌드와 실행을 별도 컨테이너로 분리하여 이미지에 필요한 부분만 담기 위한 기술.